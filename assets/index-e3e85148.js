var rt=Object.defineProperty;var it=(r,e,t)=>e in r?rt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(it(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const p=3;function nt(r){const{charWidth:e}=r;return Object.fromEntries(Object.entries(r).map(([t,s])=>t==="charWidth"&&typeof s=="number"?[t,s+p*2]:typeof s=="number"?[t,s]:[t,s.map(i=>{const o=Math.floor(i/e),l=(e+p*2)*p+p+o*p*2;return i+=l})]))}function g(r){const[e,t,s]=r;return`rgb(${e},${t},${s})`}class ot{constructor({charWidth:e,root:t,options:s}){n(this,"charWidth");n(this,"root");n(this,"options");n(this,"metrics");this.charWidth=e,this.root=t,this.options=s,this.metrics=this.calculateMetrics()}get values(){return this.metrics}setOptions(e){return this.options=e,this.metrics=this.calculateMetrics(),this.metrics}getColumnXCoord_du(e){const{cellWidth_du:t,gridSpaceX_du:s,drawAreaLeft_du:i}=this.metrics;return e*t+s*e+i}getColumnFromXCoord_du(e){const{drawAreaLeft_du:t,cellWidth_du:s,gridSpaceX_du:i}=this.metrics;let o=0,a=0;for(;a!==e-t;)a+=s+i,o+=1;return o}getRemainingRowSpace_du(e){const{displayWidth_du:t,drawAreaLeft_du:s}=this.metrics;return t-e-s}measureText(e){const{gridSpaceX_du:t,cellWidth_du:s}=this.metrics;return e.length*s+(e.length-1)*t}textFits(e,t){return this.measureText(e)<=this.getRemainingRowSpace_du(t)}calculateMetrics(){const{scale:e,displayRows:t,gridSpaceX_du:s,gridSpaceY_du:i,borderColor:o,borderWidth_du:a,borderGutter_du:u}=this.options,l=a*2+u*2,h=this.root.clientWidth-l*e,c=at(h,e,this.charWidth,s);let d;this.options.displayColumns&&this.options.displayColumns<c?d=this.options.displayColumns:d=c>0?c:1;const V=this.charWidth+i,J=t-1,Q=d-1,x=l+t*this.charWidth+J*i,Z=x*e,E=this.charWidth,j=this.charWidth,C=d*E+Q*s+l,tt=C*e,A=a+u,P=a+u,M=C-(u+a)*2,k=x-(u+a),et=M-A,st=k-P,Y={displayWidth_px:tt,displayHeight_px:Z,displayWidth_du:C,displayHeight_du:x,displayUnitsPerRow_du:V,displayColumns:d,displayRows:t,borderWidth_du:a,totalBorderWidth_du:l,borderGutter_du:u,remainingWidthXPx:h,scale:e,gridSpaceX_du:s,gridSpaceY_du:i,borderColor:o,drawAreaLeft_du:A,drawAreaTop_du:P,drawAreaRight_du:M,drawAreaBottom_du:k,drawAreaWidth_du:et,drawAreaHeight_du:st,cellWidth_du:E,cellHeight_du:j};return this.metrics=Y,Y}}function at(r,e,t,s){let i=r,o=0;const a=t*e+s*e;for(;i+s*e>a;)i-=a,o++;return o}function L(r,e,t,s=null,i=0){const o=e(t,r,s,i);return r.children.length>0?r.children.reduce((u,l)=>L(l,e,u,r,i+1),o):o}const ut=["highlight","color","outline","blink"];class O{constructor(e,t){n(this,"__text");n(this,"__parent");n(this,"__children");this.__text=e,this.__parent=t,this.__children=[]}get text(){return this.__text}get parent(){return this.__parent}get children(){return this.__children}toString(){return`${this.__text}`.trim()+" TEXT NODE"}get nextSibling(){if(this.parent){const e=this.parent.children.findIndex(s=>s===this);return this.parent.children[e+1]}}get ancestorAttributes(){return $(this,{})}}function $(r,e){return r.parent?$(r.parent,r instanceof v?{...r.attributes,...e}:e):e}class v{constructor(e,t,s){n(this,"__tagName");n(this,"__attributes");n(this,"__parent");n(this,"__children");this.__tagName=e,this.__attributes=s,this.__parent=t,this.__children=[]}get tag(){return this.__tagName}get attributes(){return this.__attributes}get parent(){return this.__parent}get children(){return this.__children}toString(){return`<${this.__tagName} ${Object.entries(this.__attributes).map(([e,t])=>`${e}=${t}`).join(" ")} ELEMENT NODE>`.trim()}get nextSibling(){if(this.parent){const e=this.parent.children.findIndex(s=>s===this);return this.parent.children[e+1]}}}function T(r){let e="";const t=[];let s=!1;for(const o of r.trim())o==="<"?(s=!0,e&&(R(t,e.trim()),e="")):o===">"?(s=!1,t.length===0&&e!=="root"&&w(t,"root"),w(t,e),e=""):e+=o;return!s&&e&&R(t,e),lt(t)}function R(r,e){if(e.trim().length===0)return;const t=r.at(-1);if(t){const s=new O(e,t);t.children.push(s)}else w(r,"root"),R(r,e)}function w(r,e){if(e.startsWith("/")){if(r.length===1)return;const t=r.pop(),s=r.at(-1);t&&(s==null||s.children.push(t))}else{const[t,s]=ht(e),i=r.at(-1),o=new v(t,i,s);r.push(o)}}function lt(r){for(r.length===0&&w(r,"root");r.length>1;){const e=r.pop(),t=r.at(-1);e&&t instanceof v&&(t==null||t.children.push(e))}return r.pop()}function ht(r){const[e,...t]=r.split(" "),s=t.reduce((i,o)=>{const[a,u]=o.split("=");return ct(a)&&(i[a]=B(u),(a==="color"&&typeof u=="string"||a==="outline"&&typeof B(u)=="string")&&(i[a]=u.match(/\d+/g))),i},{});return[e,s]}function ct(r){return ut.includes(r)}function dt(r){return L(r,(t,s,i,o)=>(t.out=t.out+`
`+" ".repeat(o*4)+s.toString(),t),{out:""}).out}function B(r){switch(r){case"true":return!0;case"false":return!1;case"null":return null;default:return r}}class f{constructor(e){n(this,"layoutList",[]);n(this,"cursor");n(this,"stepX");n(this,"stepY");n(this,"ptr");this.ptr=e;const{values:t}=this.ptr.dm;this.cursor={x:t.drawAreaLeft_du,y:t.drawAreaTop_du},this.stepX=t.cellWidth_du+t.gridSpaceX_du,this.stepY=t.cellHeight_du+t.gridSpaceY_du,this.layoutByNode()}layoutByNode(){const{drawAreaLeft_du:e}=this.ptr.dm.values;return L(this.ptr.documentTree,(t,s)=>{s.tag==="p"&&(this.cursor.y+=this.stepY,this.cursor.x=e),s instanceof O&&this.layout(s)},void 0)}layout(e){const{drawAreaLeft_du:t}=this.ptr.dm.values,s=e.text.split(" ");for(const[i,o]of s.entries()){if(o.length===0)continue;!this.ptr.dm.textFits(o,this.cursor.x)&&this.cursor.x!==t&&(this.cursor.x=t,this.cursor.y+=this.stepY),this.layoutByCharacter(o).forEach(l=>this.layoutList.push({...l,node:e,attributes:e.ancestorAttributes}));const u=this.cursor.x!==t;this.layoutList.push({x:this.cursor.x,y:this.cursor.y,char:" ",node:e,attributes:i===s.length-1?{}:e.ancestorAttributes}),u&&(this.cursor.x+=this.stepX)}}layoutByCharacter(e){const{displayColumns:t,drawAreaLeft_du:s}=this.ptr.dm.values,i=[],o=this.ptr.dm.getColumnXCoord_du(t-1);for(const a of e){if(i.push({x:this.cursor.x,y:this.cursor.y,char:a}),a===`
`){this.cursor.x=s,this.cursor.y+=this.stepY;continue}this.cursor.x===this.ptr.dm.getColumnXCoord_du(0)&&a===" "||(this.cursor.x>=o?(this.cursor.x=s,this.cursor.y+=this.stepY):this.cursor.x+=this.stepX)}return i}}function pt({index:r,columns:e}){if(r>=0){const t=Math.floor(r/e);return{x:r%e,y:t}}if(r<0){const t=Math.floor(r/e);return{x:r%e===0?r%e:r%e+e,y:t}}return{x:0,y:0}}function W(...r){return(...e)=>r.reduceRight((t,s)=>s(t),...e)}function mt(r,e,t){switch(t){case"start":return ft(r,e);case"middle":return gt(r,e);case"end":return _t(r,e);default:return r}}function ft(r,e){const t=[...r];return W(D,F,wt)([t,e])[0]}function gt(r,e){const t=[...r];return W(D,F)([t,e])[0]}function _t(r,e){const t=[...r];return W(D,F,yt)([t,e])[0]}function D(r){const[e,t]=r,s=-t,i=-1,o=1;return[e.concat(y(s,i,o)),t]}function F(r){const[e,t]=r,s=t*t,i=t*t+(t-1),o=1;return[e.concat(y(s,i,o)),t]}function wt(r){const[e,t]=r,s=0,i=t*t,o=t;return[e.concat(y(s,i,o)),t]}function yt(r){const[e,t]=r,s=t-1,i=t*t+(t-1),o=t;return[e.concat(y(s,i,o)),t]}function y(r,e,t){const s=[];for(let i=r;i<e+1;i+=t)s.push(i);return s}function xt(r,e){var i,o,a,u;const t=r[e-1],s=r[e+1];return(i=t==null?void 0:t.attributes)!=null&&i.outline?(o=t==null?void 0:t.attributes)!=null&&o.outline&&((a=s==null?void 0:s.attributes)!=null&&a.outline)?"middle":(u=s==null?void 0:s.attributes)!=null&&u.outline?null:"end":"start"}class m{constructor(e){n(this,"letter");n(this,"color");n(this,"outline1dPoints");n(this,"totalFrames");var t;this.letter=e,this.color=((t=this.letter.attributes)==null?void 0:t.color)??this.letter.ptr.dm.values.borderColor,this.outline1dPoints=this.getOutline1dPoints(),this.totalFrames=this.letter.charWidth-1}getOutline1dPoints(){return mt([],this.letter.charWidth,xt(this.letter.ptr.layout.layoutList,this.letter.letterIndex))}getFrame(e){var i;const t=this.transformPoints(e,this.letter.def,this.color);let s=[];if(this.letter.attributes.outline){const o=Array.isArray((i=this.letter.attributes)==null?void 0:i.outline)?this.letter.attributes.outline:this.color;s=this.transformPoints(e,this.outline1dPoints,o)}return t.concat(s)}transformPoints(e,t,s){return t.map(o=>{const{x:a,y:u}=pt({index:o,columns:e+1}),l=Math.random()>.95?Math.random()*K()*2:0,h=e/this.totalFrames;return{x:a+this.letter.position.x+l,y:u+this.letter.position.y,color:St(s,h*2)}})}}class Ct extends m{constructor(t){super(t);n(this,"letter");this.letter=t}enter(){}getFrame(){return[]}}class H extends m{constructor(t){super(t);n(this,"letter");n(this,"frameTimer");n(this,"frameCounter");n(this,"fps",60);n(this,"frameInterval",1e3/this.fps);n(this,"done",!1);n(this,"totalFrames");this.letter=t,this.frameTimer=0,this.frameCounter=0,this.totalFrames=this.letter.charWidth-1}enter(){}getFrame(t){return this.frameTimer>this.frameInterval?(this.frameTimer=0,this.done||this.frameCounter++):this.frameTimer+=t,this.frameCounter>=this.totalFrames&&(this.done=!0),super.getFrame(this.frameCounter)}}class b extends m{constructor(t){super(t);n(this,"letter");n(this,"totalFrames");this.letter=t,this.totalFrames=this.letter.charWidth-1}enter(){}getFrame(){return super.getFrame(this.letter.charWidth-1)}}class N extends m{constructor(t){super(t);n(this,"letter");n(this,"done");n(this,"frameTimer");n(this,"frameCounter");n(this,"fps",60);n(this,"frameInterval",1e3/this.fps);n(this,"totalFrames");this.letter=t,this.done=!1,this.frameTimer=0,this.frameCounter=0,this.totalFrames=4}enter(){this.reset(),this.letter.currentState=this.letter.states.GLITCHING}reset(){this.done=!1,this.frameCounter=0,this.frameTimer=0,this.totalFrames=Math.floor(Math.random()*10)}getFrame(t){return this.frameTimer>this.frameInterval?(this.frameTimer=0,this.done||this.frameCounter++):this.frameTimer+=t,this.frameCounter>=this.totalFrames&&(this.done=!0),super.getFrame(this.letter.charWidth-1-this.frameCounter).map(s=>({...s,color:[200,0,0]}))}}class Tt extends m{constructor(t){super(t);n(this,"letter");n(this,"frameTimer");n(this,"frameCounter");n(this,"fps",15);n(this,"frameInterval",1e3/this.fps);n(this,"totalFrames");n(this,"frameBrightnessModifiers",[0,0,0,.5,2,1,.5,0]);this.letter=t,this.frameTimer=0,this.frameCounter=0,this.totalFrames=this.frameBrightnessModifiers.length}enter(){this.letter.currentState=this.letter.states.BLINKING}getFrame(t){return this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameCounter<this.totalFrames-1?this.frameCounter++:this.frameCounter=0):this.frameTimer+=t,super.getFrame(this.letter.charWidth-1).map(i=>({...i,color:bt(i.color,this.frameBrightnessModifiers[this.frameCounter])}))}}function K(){return Math.random()>.5?-1:1}function bt(r,e){return r.map(t=>{const s=Math.floor(t*e);return s>255?255:s<0?0:s})}function St(r,e){const t=Math.floor(Math.random()*10*e)*K();return r.map(s=>(s-t)*e-(Math.random()>.8?-50:0))}class Rt{constructor(){n(this,"map");this.map=new WeakMap}addLetter(e,t){this.map.has(e)?this.map.get(e).letters.push(t):this.map.set(e,{letters:[t]})}getAllLettersForTextNode(e){var t;return(t=this.map.get(e))==null?void 0:t.letters}}const z=new Rt;class X{constructor(e){n(this,"list");n(this,"ptr");n(this,"pauseUpdates");n(this,"nodeMeta",z);this.ptr=e;let t=null;this.list=e.layout.layoutList.map((s,i)=>{const o=new U({ptr:e,position:{x:s.x,y:s.y},char:s.char,attributes:(s==null?void 0:s.attributes)??{},letterIndex:i,previousLetter:t,node:s.node});return t=o,this.nodeMeta.addLetter(s.node,o),o}),this.pauseUpdates=!1}addLetters(){const e=this.list.length-1,t=this.ptr.layout.layoutList.slice(this.list.length);let s=null;t.map((o,a)=>{const u=new U({ptr:this.ptr,position:{x:o.x,y:o.y},char:o.char,attributes:(o==null?void 0:o.attributes)??{},letterIndex:a+1+e,previousLetter:s,node:o.node});return s=u,this.nodeMeta.addLetter(o.node,u),u}).forEach(o=>this.list.push(o))}pause(){this.pauseUpdates=!0}unPause(){this.pauseUpdates=!1}updateLayout(){this.ptr.layout.layoutList.forEach((e,t)=>{const s={x:e.x,y:e.y};this.list[t].position=s})}update(){this.pauseUpdates||this.list.forEach(e=>{e.update()})}}class U{constructor({position:e,char:t,ptr:s,attributes:i,letterIndex:o,previousLetter:a,node:u}){n(this,"ptr");n(this,"position");n(this,"char");n(this,"charWidth");n(this,"def");n(this,"pixels",[]);n(this,"states");n(this,"currentState");n(this,"previousLetter");n(this,"attributes");n(this,"letterIndex");n(this,"node");this.ptr=s,this.previousLetter=a,this.letterIndex=o,this.position=e,this.char=t,this.charWidth=this.ptr.defs.charWidth,this.attributes=i,this.node=u;const l=s.defs[t.toUpperCase()];this.def=this.attributes.highlight?this.invertDef(l):l,this.states={HIDDEN:new Ct(this),FIRST_DRAW:new H(this),IDLE:new b(this),GLITCHING:new N(this),BLINKING:new Tt(this)},this.currentState=this.previousLetter?this.states.HIDDEN:this.states.FIRST_DRAW}invertDef(e){const t=[];for(let s=0;s<this.charWidth*this.charWidth;s++)e.includes(s)||t.push(s);return t}update(){if(this.currentState instanceof H&&this.currentState.done)this.currentState=this.states.IDLE;else if(this.previousLetter&&this.previousLetter.states.FIRST_DRAW.done&&!this.states.FIRST_DRAW.done)this.currentState=this.states.FIRST_DRAW;else if(this.currentState instanceof b&&Math.random()>.9993)this.states.GLITCHING.enter();else if(this.currentState instanceof N&&this.currentState.done)this.currentState=this.states.IDLE;else if(this.currentState instanceof b&&this.attributes.blink){const e=z.getAllLettersForTextNode(this.node);(e==null?void 0:e.every(s=>s.states.FIRST_DRAW.done))&&(e==null||e.forEach(s=>{s.states.BLINKING.enter()}))}}getFrame(e){return this.currentState.getFrame(e)}}class Lt{constructor(e){n(this,"ptr");n(this,"frameInterval",128);n(this,"frameTimer",0);n(this,"frameCounter",0);this.ptr=e}update(){const e=this.ptr.scrollY+this.ptr.dm.values.displayHeight_du-this.ptr.dm.values.cellHeight_du-this.ptr.dm.values.gridSpaceY_du,t=this.ptr.letters.list.findIndex(i=>!i.states.FIRST_DRAW.done),s=this.ptr.letters.list[t];(s==null?void 0:s.position.y)>e&&(this.ptr.letters.pause(),this.scroll()),this.ptr.letters.pauseUpdates&&(s==null?void 0:s.position.y)<=e&&this.ptr.letters.unPause()}scroll(){this.frameCounter===1?(this.frameCounter=0,this.ptr.scrollY+=1):this.frameCounter+=1}}const vt={0:[2,3,4,8,12,15,18,19,22,24,26,29,30,33,36,40,44,45,46],1:[3,9,10,17,24,31,38,43,44,45,46,47],2:[2,3,4,8,12,19,24,25,30,36,43,44,45,46,47],3:[2,3,4,8,12,19,24,25,26,33,36,40,44,45,46],4:[4,10,11,16,18,22,25,29,30,31,32,33,39,46],5:[1,2,3,4,5,8,15,16,17,18,26,33,36,40,44,45,46],6:[2,3,4,8,12,15,22,23,24,25,29,33,36,40,44,45,46],7:[1,2,3,4,5,12,18,24,30,37,44],8:[2,3,4,8,12,15,19,23,24,25,29,33,36,40,44,45,46],9:[2,3,4,8,12,15,19,23,24,25,26,33,40,44,45,46],charWidth:7," ":[],".":[36],",":[36,43],"'":[3,10],A:[3,9,11,15,19,22,26,29,30,31,32,33,36,40,43,47],B:[1,2,3,4,8,12,15,19,22,23,24,25,29,33,36,40,43,44,45,46],C:[2,3,4,8,12,15,22,29,36,40,44,45,46],D:[1,2,3,8,11,15,19,22,26,29,33,36,39,43,44,45],E:[1,2,3,4,5,8,15,22,23,24,25,29,36,43,44,45,46,47],F:[1,2,3,4,5,8,15,22,23,24,25,29,36,43],G:[2,3,4,8,12,15,22,29,31,32,33,36,40,44,45,46],H:[1,5,8,12,15,19,22,23,24,25,26,29,33,36,40,43,47],I:[1,2,3,4,5,10,17,24,31,38,43,44,45,46,47],J:[5,12,19,26,29,33,36,40,44,45,46,47],K:[1,5,8,11,15,17,22,23,29,31,36,39,43,47],L:[1,8,15,22,29,36,43,44,45,46,47],M:[1,5,8,9,11,12,15,17,19,22,26,29,33,36,40,43,47],N:[1,5,8,9,12,15,17,19,22,24,26,29,31,33,36,39,40,43,47],O:[2,3,4,8,12,15,19,22,26,29,33,36,40,44,45,46],P:[1,2,3,4,8,12,15,19,22,23,24,25,29,36,43],Q:[2,3,4,8,12,15,19,22,26,29,31,33,36,39,44,45,47],R:[1,2,3,4,8,12,15,19,22,23,24,25,29,31,36,39,43,47],S:[2,3,4,8,12,15,23,24,25,33,36,40,44,45,46],T:[1,2,3,4,5,10,17,24,31,38,45],U:[1,5,8,12,15,19,22,26,29,33,36,40,44,45,46],V:[1,5,8,12,15,19,22,26,29,33,37,39,45],W:[1,5,8,12,15,19,22,26,29,31,33,36,37,39,40,43,47],X:[0,6,8,12,16,18,24,30,32,36,40,42,48],Y:[1,5,8,12,16,18,24,31,38,45],Z:[1,2,3,4,5,12,18,24,30,36,43,44,45,46,47],"!":[8,15,22,36],"-":[23,24,25],"+":[10,17,22,23,24,25,26,31,38],_:[37,38,39],">":[2,10,18,26,32,32,38,44],"<":[4,10,16,22,30,30,38,46],"(":[3,9,15,22,29,37,45],")":[3,11,19,26,33,39,45],"?":[2,3,4,8,12,15,19,25,31,45],$:[3,9,10,11,12,15,17,22,23,24,25,31,33,36,37,38,39,45],"*":[3,8,10,12,16,17,18,24,30,32,36,40],"/":[12,18,24,30,36],"\\":[8,16,24,32,40],"|":[3,10,17,24,31,38,45],"^":[3,9,11,15,19],"{":[3,4,9,16,22,30,37,45,46],":":[22,36],";":[22,36,43],"}":[1,2,10,17,25,31,38,43,44],'"':[2,4,9,11],"%":[8,12,18,24,30,36,40],"@":[1,2,3,4,5,7,13,14,16,17,18,20,21,23,25,27,28,30,31,32,33,35,43,44,45,46],"#":[9,11,15,16,17,18,19,23,25,29,30,31,32,33,37,39],"&":[2,3,4,8,12,15,22,23,25,26,27,29,33,36,40,44,45,46],"`":[0,8],"~":[19,23,24,25,29]};function Wt(r){return(...e)=>e.map(t=>t*r)}function Dt(r,e){const t=Wt(e),s=i=>(...o)=>{const a=t(...o);return i.call(r,...a)};return{ctx:r,fillRect_du(...i){return s(r.fillRect)(...i)},strokeRect_du(...i){return s(r.strokeRect)(...i)},clearRect_du(...i){return s(r.clearRect)(...i)}}}class Ft{constructor(e,t){n(this,"rootElement");n(this,"canvasElement");n(this,"ctx");n(this,"defs");n(this,"dm");n(this,"drawingTools");n(this,"displayOptions");n(this,"documentSource");n(this,"documentTree");n(this,"layout");n(this,"scrollY",0);n(this,"letters");n(this,"scrollHandler");this.defs=nt(vt),this.rootElement=this.makeRoot(e,t.idExtension),this.canvasElement=this.makeCanvas(this.rootElement);const s=this.canvasElement.getContext("2d");if(!s)throw new Error("no canvas 2d context 🤷🏻");this.ctx=s,this.displayOptions={scale:2,displayRows:8,gridSpaceX_du:-3,gridSpaceY_du:5,borderColor:[200,0,120],borderWidth_du:1,borderGutter_du:5,documentSource:"",drawCellOutlines:!1,...t},this.dm=new ot({charWidth:this.defs.charWidth,root:this.rootElement,options:this.displayOptions}),this.drawingTools=Dt(this.ctx,this.dm.values.scale),this.configureCanvas(),this.documentSource=this.displayOptions.documentSource,this.documentTree=T(this.documentSource),this.layout=new f(this),this.letters=new X(this),this.scrollHandler=new Lt(this),window.addEventListener("resize",()=>this.onWindowResize())}printTree(){dt(this.documentTree)}configureCanvas(){this.ctx.canvas.width=this.dm.values.displayWidth_px,this.ctx.canvas.height=this.dm.values.displayHeight_px}onWindowResize(){const e=this.letters.list.filter(s=>s.position.y>this.scrollY&&s.position.y<this.scrollY+this.dm.values.drawAreaBottom_du&&s.currentState!==s.states.HIDDEN).at(-1);let t;if(e&&(t=(e.position.y-this.dm.values.displayRows%this.dm.values.displayUnitsPerRow_du)/this.dm.values.displayUnitsPerRow_du),this.dm.calculateMetrics(),this.configureCanvas(),this.layout=new f(this),this.letters.updateLayout(),e&&t){const s=(e.position.y-this.dm.values.displayRows%this.dm.values.displayUnitsPerRow_du)/this.dm.values.displayUnitsPerRow_du;if(t>s){const i=this.scrollY-(t-s)*this.dm.values.displayUnitsPerRow_du;this.scrollY=i>0?i:0}else t<s&&(this.scrollY+=(s-t)*this.dm.values.displayUnitsPerRow_du)}}appendToDocument(e){if(this.layout.layoutList.length===0)return this.setDocument(e);T(e).children.forEach(s=>this.documentTree.children.push(s)),this.layout=new f(this),this.letters.addLetters()}setDocument(e){this.documentSource=e,this.documentTree=T(this.documentSource),this.layout=new f(this),this.letters=new X(this),this.scrollY=0}update(){this.letters.update(),this.scrollHandler.update()}draw(e){this.clearDrawArea(),this.letters.list.map(s=>s.getFrame(e)).flat().forEach(s=>{this.ctx.fillStyle=g(s.color),this.drawingTools.fillRect_du(s.x,s.y-this.scrollY,1,1)}),this.drawBorder(),this.drawCellOutlines()}clearDrawArea(){const{displayHeight_du:e,displayWidth_du:t}=this.dm.values,s=[0,0,t,e];this.drawingTools.clearRect_du(...s)}makeRoot(e,t){const s=document.createElement("div");return s.setAttribute("id",`__PTRwindow_root_element-${t}`),s.classList.add("PTRwindow_root_element"),s.style.boxSizing="border-box",e.appendChild(s),s}makeCanvas(e){const t=document.createElement("canvas");return t.setAttribute("id","__PTRwindow_canvas_element"),t.style.background="black",e.appendChild(t),t}drawCellOutlines(){if(!this.displayOptions.drawCellOutlines)return;this.ctx.lineWidth=1,this.ctx.strokeStyle=g([0,100,220]);const{drawAreaLeft_du:e,drawAreaTop_du:t,cellWidth_du:s,cellHeight_du:i,gridSpaceY_du:o,gridSpaceX_du:a,displayColumns:u,displayRows:l}=this.dm.values;for(let h=0;h<l;h++)for(let c=0;c<u;c++)this.drawingTools.strokeRect_du(e+s*c+a*c,t+i*h+o*h,s,i)}drawBorder(){const{borderColor:e,borderWidth_du:t,scale:s,displayHeight_du:i,displayWidth_du:o}=this.dm.values;this.ctx.strokeStyle=g(e),this.ctx.lineWidth=t*s,this.drawingTools.strokeRect_du(t/2,t/2,o-t,i-t)}run(){let e=0;const t=s=>{const i=s-e;e=s,this.update(),this.draw(i),requestAnimationFrame(t)};return t(0),this}}const I=g([10,100,254]),q=`
<span color=${I}>  
  <span highlight=true>
    Resistance <span highlight=false outline=true>is</span> <span blink=true>futile</span>
  </span>
  <p>We are the <span blink=true>B</span><span blink=true>O</span><span blink=true>R</span><span blink=true>G</span>. Lower your shields and surrender your ships. We will add your biological and technological distinctiveness to our own. Your culture will adapt to service us.</p>
</span>
`,_=new Ft(document.getElementById("root"),{scale:3,displayRows:7,documentSource:q,borderWidth_du:0,borderColor:[0,0,0],gridSpaceX_du:0,idExtension:"1"}).run();window._ptr=_;const G=()=>`<span color=${I} highlight=true></span>`,It=[{id:"appendToDocument",text:"Append to document",onClick:()=>{const r=prompt("Append to Document",G())??"";_.appendToDocument(r)}},{id:"setDocument",text:"Set Document",onClick:()=>{const r=prompt("Set Document",G())??"";_.setDocument(r)}},{id:"reset",text:"Reset Example",onClick:()=>{_.setDocument(q)}}],S=document.getElementById("devHarnessButtons");It.forEach(r=>{const e=document.createElement("button");e.id=r.id,e.innerText=r.text,e.onclick=r.onClick,e.style.background=I,S==null||S.appendChild(e)});
